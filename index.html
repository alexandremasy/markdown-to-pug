<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Markdown to PugJS</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.31.0/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.31.0/theme/mbo.min.css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:400,700" rel="stylesheet">
    <link rel="stylesheet" href="app.css">

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.31.0/codemirror.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.31.0/mode/markdown/markdown.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.31.0/mode/xml/xml.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.31.0/mode/pug/pug.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.31.0/mode/htmlmixed/htmlmixed.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="lib/bundle.js"></script>
    <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/8.4.0/markdown-it.min.js"></script>
    <script type="text/javascript" src="lib/markdown-to-pug.js"></script>
    <script type="text/javascript" src="lib/pug-mixin.js"></script> -->
  </head>
  <body>
    <!--
      1. Markdown
      2. PugJS
      3. HTML
     -->

    <div class="editors">
      <div class="editors__editor markdown">
        <header class="editor__header">
          <h1>Markdown</h1>
        </header>
        <div class="editor__content">
          <textarea id="markdownEditor" name="markdownEditor">
# Heading 1
          </textarea>
        </div>
      </div>

      <div class="editors__editor pugjs">
        <header class="editor__header">
          <h1>PugJS</h1>
        </header>
        <div class="editor__content">
          <textarea name="pugEditor" id="pugEditor"></textarea>
        </div>
      </div>

      <div class="editors__editor html">
        <header class="editor__header">
          <h1>HTML</h1>
        </header>
        <div class="editor__content">
          <textarea name="htmlEditor" id="htmlEditor"></textarea>
        </div>
      </div>
    </div>

    <script type="text/javascript">

      (function(window)
      {
        /**
         *  Application
         **/
        function App()
        {
          this.init();
        }

        /**
         *  Prototype
         **/
        var p = App.prototype;

        /**
         *  Init the app
         **/
        p.init = function()
        {
          this.md2pug = new MarkdownToPug();
          this.theme = 'mbo';

          this.markdownEditor = CodeMirror.fromTextArea(document.getElementById("markdownEditor"), {
            mode: 'markdown',
            theme: this.theme,
            lineNumbers: true,
            lineWrapping: true,
            extraKeys: {"Enter": "newlineAndIndentContinueMarkdownList"},
          });

          this.pugEditor = CodeMirror.fromTextArea(document.getElementById("pugEditor"), {
            mode: {name: "pug", alignCDATA: true},
            theme: this.theme,
            readOnly: true,
            lineNumbers: true,
            lineWrapping: true
          });

          this.htmlEditor = CodeMirror.fromTextArea(document.getElementById("htmlEditor"), {
            mode: 'text/html',
            theme: this.theme,
            readOnly: true,
            lineNumbers: true,
            selectionPointer: true,
            lineWrapping: true
          });

          this.setContent( this.markdownEditor.doc.getValue() );
          this.markdownEditor.on('change', onMarkdownChange.bind(this));
        }

        /**
         *  Set the content
         *
         *  @param value String
         **/
        p.setContent = function(value)
        {
          var p = this.md2pug.render(value);
          this.pugEditor.doc.setValue(p);
        }

        function onMarkdownChange(editor, change)
        {
          var val = editor.doc.getValue();
          this.setContent(val);
        }

        jQuery(document).ready(function()
        {
          new App();
        });
      })(window);


    </script>



  </body>
</html>
